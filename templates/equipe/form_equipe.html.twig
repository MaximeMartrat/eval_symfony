{% extends 'base.html.twig' %}

{% block title %}Equipes{% endblock %}
 
{% block body %}
<div class="d-flex align-items-start">
  <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
    <button class="nav-link active" id="v-pills-equipe-tab" data-bs-toggle="pill" data-bs-target="#v-pills-equipe" type="button" role="tab" aria-controls="v-pills-equipe" aria-selected="true">Equipe</button>
    <button class="nav-link" id="v-pills-manager-tab" data-bs-toggle="pill" data-bs-target="#v-pills-manager" type="button" role="tab" aria-controls="v-pills-manager" aria-selected="false">Manager</button>
    <button class="nav-link" id="v-pills-joueur-tab" data-bs-toggle="pill" data-bs-target="#v-pills-joueur" type="button" role="tab" aria-controls="v-pills-joueur" aria-selected="false">Joueur</button>
  </div>
  <div class="tab-content" id="v-pills-tabContent">
    <div class="tab-pane fade show active" id="v-pills-equipe" role="tabpanel" aria-labelledby="v-pills-equipe-tab" tabindex="0"><style>
        .wrapper {
            margin: 1em auto;
            width: 95%;
        }
        body{
            text-align: center;
            font-family: 'Poppins', sans-serif;
        }
        a{
            text-decoration: none;
        }
    </style>
    <div class="wrapper">
        <h1>EQUIPE</h1><br>
        {{ form_start(form) }}
            {{ form_row(form.nom) }}
            {{ form_row(form.ville) }}
            <button type="submit" class="btn btn-success">Creer Equipe</button>
        {{ form_end(form) }}
    </div>
   </div>
    <div class="tab-pane fade" id="v-pills-manager" role="tabpanel" aria-labelledby="v-pills-manager-tab" tabindex="0"><style>
        .wrapper {
            margin: 1em auto;
            width: 95%;
        }
        body{
            text-align: center;
            font-family: 'Poppins', sans-serif;
        }
        a{
            text-decoration: none;
        }
    </style>
    <div class="wrapper">
        <h1>MANAGERS</h1><br>
        <form id="form1" method="POST">
        <table class="table table-striped table-hover table-bordered">
            <thead class="table-dark">
            <tr>
                <th scope="col">NOM</th>
                <th scope="col">PRENOM</th>
                <th scope="col">ROLE</th>
                <th scope="col">SALAIRE</th>
                <th scope="col">SELECT</th>
            </tr>
            </thead>
            <tbody>
            {% for manager in managers %}
                <tr>
                    <td>{{ manager.nom|upper }}</td>
                    <td>{{ manager.prenom|upper }}</td>
                    <td>{{ manager.role|upper }}</td>
                    <td>{{ manager.salaire|upper }}</td>
                    <!-- si le manager n'est pas dans une equipe on affiche la checkbox -->
                    {% if manager.getManagerEquipe() is null %}
                    <td><input class="managercheck" type="checkbox" name="manager" value="{{ manager.id }}"></td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <button id='btn_managers' type='submit'>Recruter Manager</button>
        </form>
    </div>
    </div>
    <div class="tab-pane fade" id="v-pills-joueur" role="tabpanel" aria-labelledby="v-pills-joueur-tab" tabindex="0"><style>
        .wrapper {
            margin: 1em auto;
            width: 95%;
        }
        body{
            text-align: center;
            font-family: 'Poppins', sans-serif;
        }
        a{
            text-decoration: none;
        }
    </style>
    <div class="wrapper">
        <h1>JOUEURS</h1><br>
        <form id="form2" method="POST">
        <table class="table table-striped table-hover table-bordered">
            <thead class="table-dark">
            <tr>
                <th scope="col">NOM</th>
                <th scope="col">PRENOM</th>
                <th scope="col">POSITION</th>
                <th scope="col">VITESSE</th>
                <th scope="col">DRIBBLE</th>
                <th scope="col">TIR</th>
                <th scope="col">RENOMMEE</th>
                <th scope="col">SALAIRE</th>
                <th scope="col">ARRET</th>
                <th scope="col">SELECT</th>
            </tr>
            </thead>
            <tbody>
            {% for joueur in joueurs %}
                <tr>
                    <td>{{ joueur.nom|upper }}</td>
                    <td>{{ joueur.prenom|upper }}</td>
                    <td>{{ joueur.position|upper }}</td>
                    <td>{{ joueur.vitesse|upper }}</td>
                    <td>{{ joueur.dribble|upper }}</td>
                    <td>{{ joueur.tir|upper }}</td>
                    <td>{{ joueur.renommee|upper }}</td>
                    <td>{{ joueur.salaire|upper }}</td>
                    <td>{{ joueur.arret|upper }}</td>
                    <!-- si le joueur n'est pas dans une equipe on affiche la checkbox -->
                    {% if joueur.getJoueurEquipe() is null %}
                        <td><input class="joueurcheck" name="joueur"type="checkbox" value="{{ joueur.id }}"></td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <button id='btn_joueurs' type="submit">Recruter joueur</button>
        </form>
    </div>
    
    </div>
  </div>
</div>
<script>

        //fonction pour exclure du tableau la checkbox que l'on déselectionne 
        Array.prototype.pull = function (item) {
            let index = this.indexOf(item);
            if (index > -1) {
            this.splice(index, 1);
                return index;
            } else {
                return -1;
            }
        };
        //recupération des données du dom
        const joueurs = document.getElementsByClassName("joueurcheck");
        const managers = document.getElementsByClassName("managercheck");
        //création de tableau vides pour ajouter les joueurs et managers sélectionner
        let equipeJoueurs = [];
        let equipeManagers = [];
        //boucles sur les checkbox pour vérifier celles checkes et ajouter dans le tableau correspondant l'id du joueur ou du manager attribuée comme valeur à l'input
        for(let i = 0; i < joueurs.length; i++) {
            joueurs[i].addEventListener("change", function(){
                if(this.checked) {
                    equipeJoueurs.push(this.value);
                } else {
                    equipeJoueurs.pull(this.value);
                }
            if(equipeJoueurs.length > 21) {
                console.log('equipe de joueur complète');

            }
            });
        };
        for(let i = 0; i < managers.length; i++) {
            managers[i].addEventListener("change", function(){
                if(this.checked) {
                    equipeManagers.push(this.value);
                } else {
                    equipeManagers.pull(this.value);
                }
            if(equipeManagers.length > 4) {
                console.log('equipe de manager complète');
            }
            });
        };

        //requète ajax pour envoyer les données des tableaux managers et joueurs au controller 
        $.ajax({
            type: 'POST',
            url: '/createEquipe',
            data: {
                joueurs: equipeJoueurs,
                managers: equipeManagers
            },
            success: function(response) {
                console.log("Les équipes ont étées créée avec succès !");
            },
            error: function(error) {
                console.error("Erreur lors de la création de l'équipe :", error);
            }
        });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
{% endblock %}